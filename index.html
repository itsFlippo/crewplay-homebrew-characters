<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Charakterâ€‘Wiki</title>
  <meta name="description" content="Ein leichtgewichtiges, statisches Wiki fÃ¼r Charaktere mit Suche und Sortierung." />
  <style>
    :root{
      --bg: #0b1020; /* deep indigo */
      --panel: #121833;
      --panel-2:#0f1530;
      --text: #e7ecff;
      --muted:#9fb0ff;
      --accent:#7aa2ff;
      --accent-2:#b4c6ff;
      --ok:#26d07c;
      --chip:#1a2247;
      --badge:#233067;
      --border:#1a2452;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#060914 70%);
      color:var(--text); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, Apple Color Emoji, Segoe UI Emoji;
    }
    a{color:var(--accent)}
    header{
      position:sticky; top:0; z-index:5; backdrop-filter:saturate(140%) blur(8px);
      background:linear-gradient(180deg,rgba(6,9,20,.85),rgba(6,9,20,.55)); border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1100px; margin-inline:auto; padding:1rem;}
    .bar{display:grid; gap:.75rem; grid-template-columns: 1fr; align-items:center}
    @media (min-width:800px){ .bar{grid-template-columns: 1fr auto auto} }
    h1{font-size:clamp(20px,3vw,28px); margin:0}
    .muted{color:var(--muted); font-weight:500}
    .search{
      display:flex; align-items:center; gap:.5rem; background:var(--panel); border:1px solid var(--border); border-radius:999px; padding:.5rem .75rem; box-shadow:var(--shadow);
    }
    .search input{flex:1; background:transparent; border:0; outline:0; color:var(--text); font-size:1rem}
    .chip-row{display:flex; flex-wrap:wrap; gap:.5rem}
    .chip{background:var(--chip); border:1px solid var(--border); color:var(--accent-2); padding:.35rem .7rem; border-radius:999px; cursor:pointer; user-select:none}
    .chip.active{background:var(--badge); color:var(--text)}
    .controls{display:flex; gap:.5rem; align-items:center}
    select, button{
      appearance:none; background:var(--panel); color:var(--text); border:1px solid var(--border);
      padding:.55rem .8rem; border-radius:10px; box-shadow:var(--shadow); cursor:pointer
    }
    button.secondary{background:var(--panel-2)}
    main{padding:1rem 0}
    .grid{display:grid; gap:1rem}
    @media (min-width:700px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (min-width:1024px){ .grid{grid-template-columns:repeat(3,1fr)} }
    .card{
      background:linear-gradient(0deg, var(--panel-2), var(--panel)); border:1px solid var(--border); border-radius:var(--radius);
      padding:1rem; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:.6rem; min-height:190px
    }
    .title{display:flex; gap:.5rem; align-items:center; justify-content:space-between}
    .name{font-weight:700; font-size:1.05rem}
    .badge{font-size:.75rem; padding:.2rem .5rem; border-radius:999px; background:var(--badge); color:var(--accent-2); border:1px solid var(--border)}
    .ability{color:var(--accent-2)}
    pre{
      margin:0; background:#03060f; color:#d9e2ff; border:1px dashed var(--border); border-radius:12px; padding:.6rem; max-height:170px; overflow:auto; font-size:.85rem
    }
    .row{display:flex; gap:.5rem; align-items:center}
    .spacer{flex:1}
    footer{border-top:1px solid var(--border); padding:1rem 0; color:var(--muted)}
    .empty{opacity:.7; text-align:center; padding:3rem 1rem}
    .kbd{border:1px solid var(--border); background:var(--panel); padding:.1rem .35rem; border-radius:6px; font-size:.85em}
  </style>
</head>
<body>
  <header>
    <div class="wrap bar" role="search">
      <h1>Charakterâ€‘Wiki <span class="muted">â€¢ Suche & Sortierung</span></h1>
      <label class="search" aria-label="Charaktere durchsuchen">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="10.5" cy="10.5" r="6.5" stroke="currentColor" stroke-width="2"/></svg>
        <input id="q" type="search" placeholder="Suchen (z.â€¯B. Name, Ability, Alignment)â€¦" autocomplete="off" />
        <kbd class="kbd">/</kbd>
      </label>
      <div class="controls">
        <select id="sort" aria-label="Sortierung wÃ¤hlen">
          <option value="name-asc">Name Aâ€“Z</option>
          <option value="name-desc">Name Zâ€“A</option>
          <option value="alignment-asc">Alignment Aâ€“Z</option>
          <option value="alignment-desc">Alignment Zâ€“A</option>
        </select>
        <button id="addBtn" class="secondary" title="Charakter hinzufÃ¼gen (nur lokal)">+ HinzufÃ¼gen</button>
        <button id="exportBtn" title="Alle EintrÃ¤ge als JSON exportieren">Export</button>
      </div>
    </div>
    <div class="wrap" style="padding-top:.25rem; padding-bottom: .8rem">
      <div class="chip-row" id="filters" aria-label="Alignmentâ€‘Filter"></div>
    </div>
  </header>

  <main class="wrap">
    <section id="list" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" hidden>
      <p>Keine EintrÃ¤ge gefunden. Filter/Suche zurÃ¼cksetzen oder neue Charaktere hinzufÃ¼gen.</p>
    </div>
  </main>

  <footer class="wrap">
    <p>
      <strong>EintrÃ¤ge pflegen</strong>: Diese Seite ist <em>statisch</em>. Du kannst unten in den HTMLâ€‘Code schauen und
      den <code>&lt;script type="application/json" id="characters-data"&gt;</code> Block bearbeiten.
      Auf GitHub Ã¤nderst du die Datei(n) einfach per Commit und Push. Optional kannst du die Daten Ã¼ber
      <em>Export</em> herunterladen und spÃ¤ter ersetzen.
    </p>
  </footer>

  <!--
    ðŸ”§ Datenquelle
    - Bearbeite dieses JSON, um Charaktere zu pflegen.
    - Jede Figur: { name, alignment, ability, json }
    - alignment: z.B. Townsfolk | Outsider | Minion | Demon | Traveller | â€¦
  -->
  <script type="application/json" id="characters-data">{
    "characters": [
      {
        "name": "Washerwoman",
        "alignment": "Townsfolk",
        "ability": "You start knowing that one of two players is a particular Townsfolk (but you might be wrong).",
        "json": {"id":"washerwoman","edition":"Trouble Brewing","type":"townsfolk"}
      },
      {
        "name": "Librarian",
        "alignment": "Townsfolk",
        "ability": "You start knowing that one of two players is a particular Outsider (but you might be wrong).",
        "json": {"id":"librarian","edition":"Trouble Brewing","type":"townsfolk"}
      },
      {
        "name": "Investigator",
        "alignment": "Townsfolk",
        "ability": "You start knowing that 1 of 2 players is a particular Minion (but you might be wrong).",
        "json": {"id":"investigator","edition":"Trouble Brewing","type":"townsfolk"}
      },
      {
        "name": "Imp",
        "alignment": "Demon",
        "ability": "Each night*, choose a player: they die. If you kill yourself this way, a Minion becomes the Imp.",
        "json": {"id":"imp","edition":"Trouble Brewing","type":"demon"}
      }
    ]
  }</script>

  <script>
    // --- Utilities ---
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => [...el.querySelectorAll(sel)];

    // Read initial data from inline JSON
    function loadData(){
      try{
        const raw = $('#characters-data').textContent.trim();
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed.characters) ? parsed.characters : [];
      }catch(e){
        console.error('JSON fehlerhaft:', e);
        return [];
      }
    }

    let data = loadData();
    let filtered = [...data];

    const list = $('#list');
    const empty = $('#empty');
    const q = $('#q');
    const sortSel = $('#sort');
    const filtersEl = $('#filters');

    const alignments = [...new Set(data.map(d => d.alignment))].sort((a,b)=>a.localeCompare(b));

    // Build filter chips
    const activeAlignments = new Set();
    function renderChips(){
      filtersEl.innerHTML = '';
      const all = document.createElement('button');
      all.type = 'button'; all.className = 'chip' + (activeAlignments.size===0 ? ' active' : '');
      all.textContent = 'Alle';
      all.onclick = () => { activeAlignments.clear(); apply(); };
      filtersEl.appendChild(all);
      alignments.forEach(a=>{
        const btn = document.createElement('button');
        btn.type='button'; btn.className='chip'; btn.textContent=a;
        btn.onclick = ()=>{
          if(activeAlignments.has(a)) activeAlignments.delete(a); else activeAlignments.add(a);
          apply();
        };
        filtersEl.appendChild(btn);
      });
    }

    function highlightChips(){
      $$('.chip', filtersEl).forEach(btn=>{
        const label = btn.textContent;
        if(label==='Alle'){
          btn.classList.toggle('active', activeAlignments.size===0);
        } else {
          btn.classList.toggle('active', activeAlignments.has(label));
        }
      });
    }

    function render(){
      list.innerHTML = '';
      if(filtered.length===0){ empty.hidden=false; return; }
      empty.hidden=true;
      for(const c of filtered){
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="title">
            <div class="name">${escapeHTML(c.name)}</div>
            <span class="badge" title="Alignment">${escapeHTML(c.alignment)}</span>
          </div>
          <div class="ability">${escapeHTML(c.ability)}</div>
          <pre aria-label="JSON Code"><code>${escapeHTML(JSON.stringify(c.json, null, 2))}</code></pre>
        `;
        list.appendChild(card);
      }
    }

    function escapeHTML(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }

    function apply(){
      const term = q.value.trim().toLowerCase();
      filtered = data.filter(c => {
        const byAlign = activeAlignments.size===0 || activeAlignments.has(c.alignment);
        if(!byAlign) return false;
        if(!term) return true;
        const hay = `${c.name} ${c.alignment} ${c.ability} ${JSON.stringify(c.json)}`.toLowerCase();
        return hay.includes(term);
      });
      sortNow();
      highlightChips();
      render();
    }

    function sortNow(){
      const v = sortSel.value;
      const cmpTxt = (a,b,k) => a[k].localeCompare(b[k], 'de', {sensitivity:'base'});
      if(v==='name-asc') filtered.sort((a,b)=>cmpTxt(a,b,'name'));
      if(v==='name-desc') filtered.sort((a,b)=>cmpTxt(b,a,'name'));
      if(v==='alignment-asc') filtered.sort((a,b)=>cmpTxt(a,b,'alignment') || cmpTxt(a,b,'name'));
      if(v==='alignment-desc') filtered.sort((a,b)=>cmpTxt(b,a,'alignment') || cmpTxt(a,b,'name'));
    }

    // Search keyboard focus with '/'
    window.addEventListener('keydown', (e)=>{
      if(e.key==='/' && document.activeElement!==q){ e.preventDefault(); q.focus(); q.select(); }
    });

    q.addEventListener('input', apply);
    sortSel.addEventListener('change', apply);

    renderChips();
    apply();

    // --- Add / Export (localâ€‘only helpers) ---
    $('#addBtn').addEventListener('click', async ()=>{
      const name = prompt('Charaktername:'); if(!name) return;
      const alignment = prompt('Alignment (z.B. Townsfolk, Outsider, Minion, Demon):'); if(!alignment) return;
      const ability = prompt('Ability (Beschreibung):'); if(!ability) return;
      let jsonStr = prompt('JSON Code (z.B. {"id":"imp","type":"demon"}):', '{}');
      try{ jsonStr = JSON.stringify(JSON.parse(jsonStr)); }catch{ alert('JSON ungÃ¼ltig â€“ es wird {} verwendet.'); jsonStr = '{}'; }
      const entry = { name, alignment, ability, json: JSON.parse(jsonStr) };
      data.push(entry);
      // keep alignments up to date
      if(!alignments.includes(alignment)) { alignments.push(alignment); alignments.sort((a,b)=>a.localeCompare(b)); renderChips(); }
      apply();
      alert('HinzugefÃ¼gt (nur lokal). Nutze "Export", um die Daten zu speichern & ins Repo zu Ã¼bernehmen.');
    });

    $('#exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify({characters:data}, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'characters.json';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>